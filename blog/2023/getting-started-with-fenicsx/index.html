<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Getting started with FEniCSx | Bibekananda Datta </title> <meta name="author" content="Bibekananda Datta"> <meta name="description" content="A tutorial on how to set up FEniCSx and compile your first program"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link defer href="/assets/css/bootstrap-toc.min.css?6f5af0bb9aab25d79b2448143cbeaa88" rel="stylesheet"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bibekanandadatta.com/blog/2023/getting-started-with-fenicsx/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Bibekananda</span> Datta </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">Research </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/surfboard/">Surfboard </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="row"> <div class="col-sm-3"> <nav id="toc-sidebar" class="sticky-top"></nav> </div> <div class="col-sm-9"> <div class="post"> <header class="post-header"> <h1 class="post-title">Getting started with FEniCSx</h1> <p class="post-meta"> April 20, 2023 </p> <p class="post-tags"> <a href="/blog/2023"> <i class="fa-solid fa-calendar fa-sm"></i> 2023 </a>   ·   <a href="/blog/tag/fenicsx"> <i class="fa-solid fa-hashtag fa-sm"></i> FEniCSx</a>   <a href="/blog/tag/finite-element"> <i class="fa-solid fa-hashtag fa-sm"></i> finite-element</a>   <a href="/blog/tag/python"> <i class="fa-solid fa-hashtag fa-sm"></i> Python</a>   <a href="/blog/tag/programming"> <i class="fa-solid fa-hashtag fa-sm"></i> programming</a>   <a href="/blog/tag/anaconda"> <i class="fa-solid fa-hashtag fa-sm"></i> Anaconda</a>   <a href="/blog/tag/wsl"> <i class="fa-solid fa-hashtag fa-sm"></i> WSL</a>     ·   <a href="/blog/category/tutorial"> <i class="fa-solid fa-tag fa-sm"></i> tutorial</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p><code class="language-plaintext highlighter-rouge">FEniCSx</code> is an open-source multi-platform computing environment to solve partial differential equations using the finite element method. <code class="language-plaintext highlighter-rouge">FEniCSx</code> supports parallel computing with Python and C++ interfaces. <code class="language-plaintext highlighter-rouge">FEniCSx</code> is comprised of the libraries UFL, Basix, FFCx, and DOLFINx which are the build blocks of it.</p> <p>The project originally started in 2003 and was known as <code class="language-plaintext highlighter-rouge">FEniCS</code>. In 2020, the developers released a new version of the library which they renamed <code class="language-plaintext highlighter-rouge">FEniCSx</code>. The latest stable version of legacy <code class="language-plaintext highlighter-rouge">FEniCS</code> was released in April 2019 and it’s barely updated. But many tutorials and legacy codes are perhaps written in legacy <code class="language-plaintext highlighter-rouge">FEniCS</code>. So you may want to install a version of it. I will demonstrate installing both versions on multiple different platforms here.</p> <p>Both <code class="language-plaintext highlighter-rouge">FEniCSx</code> and <code class="language-plaintext highlighter-rouge">FEniCS</code> are available on Linux, macOS, and Windows. You can download and install it in different ways. Check out the <a href="https://github.com/FEniCS/dolfinx" rel="external nofollow noopener" target="_blank">options here for FEniCSx</a> and <a href="https://fenicsproject.org/download/archive/" rel="external nofollow noopener" target="_blank">legacy FEniCS</a>. For both versions, my preferred approach is to install them via Anaconda.</p> <h2 id="installation-on-windows">Installation on Windows</h2> <p>This step in only applicable if you are using Windows. You will have to set up Windows Subsystem for Linux (WSL) to use Anaconda-based installation of <code class="language-plaintext highlighter-rouge">FEniCSx</code> and legacy <code class="language-plaintext highlighter-rouge">FEniCS</code>. WSL is a virtual Linux environment within Windows that allows you to use Linux command line tools and GUI applications. If you are on macOS or Linux, you can skip this step. If you are on Windows and already have installed WSL, it still might be interesting to download the recommended applications/ tools, such as VS Code.</p> <h2 id="get-your-tools-ready-first">Get your tools ready first</h2> <p><em>It’s best to have your tools with you. If you don’t, you’re apt to find something you didn’t expect and get discouraged.</em> – Stephen King.</p> <h3 id="powershell-7">PowerShell 7</h3> <p>Microsoft Windows already comes with Windows PowerShell 5.1, but the modern edition of PowerShell 7 is more powerful and available on different operating systems. To learn more, <a href="https://learn.microsoft.com/en-us/powershell/scripting/install/installing-powershell-on-windows" rel="external nofollow noopener" target="_blank">check this</a>.</p> <ol> <li> <p>Install the App Installer from the Microsoft App Store. This will enable the <code class="language-plaintext highlighter-rouge">winget</code> tool on the default PowerShell 5.1 and new PowerShell 7.X.Y to be installed.</p> </li> <li> <p>Open the default Windows PowerShell 5.1 as <strong>administrator</strong> from the Windows Start menu, then do the following:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>winget search Microsoft.PowerShell
</code></pre></div> </div> <p>This command will return the available PowerShell versions to install. I do not recommend installing the <code class="language-plaintext highlighter-rouge">.preview</code> version.</p> </li> <li> <p>Now install the stable release of PowerShell using the following command:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> winget install --id Microsoft.Powershell --source winget
</code></pre></div> </div> </li> </ol> <h3 id="windows-terminal">Windows Terminal</h3> <p>Windows Terminal is a command line tool, available on <a href="https://apps.microsoft.com/store/apps" rel="external nofollow noopener" target="_blank">Microsoft Store</a>. Install it from there. You can manage multiple command line environments such as Windows PowerShell 5.1, PowerShell 7.X.Y, CMD, WSL, etc. using a single application.</p> <h3 id="visual-studio-code">Visual Studio Code</h3> <p>Visual Studio Code is a cross-platform code editor from Microsoft. You can install different extensions within VS Code to enable features for code development such as remote SSH, debugging, compiling, etc.</p> <ol> <li> <p>Download VS Code <a href="https://code.visualstudio.com/download" rel="external nofollow noopener" target="_blank">from here</a> for your operating system. Follow graphical instructions for installation.</p> </li> <li> <p>If you want to open an empty file in your current working directory using VS Code, then type:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>code .
</code></pre></div> </div> </li> <li> <p>To open a file using VS Code from the terminal, go to the directory from the terminal and type:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>code filename.ext
</code></pre></div> </div> </li> <li> <p>Once installed, add the extension packs for Python, Remote Development, and Jupyter, from Microsoft. These packages will be necessary for smooth operation.</p> </li> </ol> <h3 id="windows-subsystem-for-linux-wsl">Windows Subsystem for Linux (WSL)</h3> <ol> <li> <p>The current stable version for Windows Subsystem for Linux is WSL2 and this is the default installation. Open PowerShell 7.X.Y (your current installation version) as <strong>administrator</strong> using the Terminal app from the Windows Start menu and then type the following command:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> wsl --list --online
</code></pre></div> </div> <p>This command will show you currently available Linux distributions on Windows.</p> </li> <li> <p>Install the latest LTS version of Ubuntu which is Ubuntu 22.04.02 LTS:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>wsl --install -d Ubuntu
</code></pre></div> </div> <p>It will ask you to create a user account and set a password. The installation process is fast and straightforward.</p> </li> <li> <p>Once Ubuntu in WSL is installed, you can use it similarly to a regular Ubuntu distribution. To run Ubuntu, open it from the Terminal application option. If this is your first time using Linux, you can familiarize yourself with <a href="https://ubuntu.com/tutorials/command-line-for-beginners" rel="external nofollow noopener" target="_blank">some commands and operations from here</a>.</p> </li> <li> <p>Now update the Ubuntu distribution and install two packages for WSL virtual display settings.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>sudo apt update &amp;&amp; upgrade
sudo apt install xvfb libgl1-mesa-glx
</code></pre></div> </div> <p>The first command will ask for your password. Proceed as needed.</p> </li> <li> <p>To open Windows like <code class="language-plaintext highlighter-rouge">File Explorer</code> from Ubuntu, type:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>explorer.exe .
</code></pre></div> </div> <p>You can open the WSL home directory and browse, copy, and move files like Windows.</p> </li> <li> <p>Once you have installed Ubuntu in WSL and VS Code, you can follow these tutorials to get yourself more familiarized with the VS Code environments and capabilities in WSL from these resources: <a href="https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-vscode" rel="external nofollow noopener" target="_blank">https://learn.microsoft.com/en-us/windows/wsl/tutorials/wsl-vscode</a> and <a href="https://code.visualstudio.com/docs/remote/wsl-tutorial" rel="external nofollow noopener" target="_blank">https://code.visualstudio.com/docs/remote/wsl-tutorial</a>.</p> </li> <li> <p>To use packages and libraries installed in WSL, start VS Code from the Ubuntu terminal.</p> </li> </ol> <h2 id="anaconda-on-linux-wsl-and-macos">Anaconda on Linux (WSL) and macOS</h2> <p>If this is the first time you are using Python, then sit back, it is going to get confusing like this <a href="https://xkcd.com/1987/" rel="external nofollow noopener" target="_blank">xkcd comic</a>. Even if you are experienced in Python, you might find this interesting.</p> <p>Most of the Python-based libraries and packages often depend on other libraries and packages (called dependencies). Installing the right version of those packages and maintaining them is often a complex task even for experienced developers. So, I will use a popular Python distribution, Anaconda, to manage all the Python-based libraries and relevant dependencies. Anaconda uses the <code class="language-plaintext highlighter-rouge">conda</code> package manager and works well with <code class="language-plaintext highlighter-rouge">pip</code> (Python’s default package manager). Installation of Anaconda comes with popular Python packages such as NumPy, SciPy, Matplotlib, and <em>&lt;insert hundred other packages here&gt;</em>. It also comes with Jupyter Notebook and Spyder IDE. Anaconda also has a minimalist version, called Miniconda, which is lightweight because it only includes the <code class="language-plaintext highlighter-rouge">conda</code> manager and a few packages. I strongly recommend installing Anaconda instead of Miniconda.</p> <ol> <li> <p>This step is only for macOS. Install <code class="language-plaintext highlighter-rouge">xcode</code> command line tools to obtain basic development libraries and features. On the macOS terminal, type:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>xcode-select --install
</code></pre></div> </div> </li> <li> <p>Download Anaconda <a href="https://www.anaconda.com/products/distribution" rel="external nofollow noopener" target="_blank">from here</a> based on your operating system and architecture..</p> </li> <li> <p>On macOS, you can download the graphical installer and install it like every other software by following the on-screen instructions. Alternatively, you can download the installation script and use the command line to install Anaconda like Linux. Details of the installation procedure are <a href="https://docs.anaconda.com/anaconda/install/mac-os/" rel="external nofollow noopener" target="_blank">available here</a>.</p> </li> <li> <p>For WSL, download the installation script. Open the Ubuntu terminal and use the following command to download the script to the WSL home directory:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>wget https://repo.anaconda.com/archive/Anaconda3-2023.03-Linux-x86_64.sh
</code></pre></div> </div> <p><code class="language-plaintext highlighter-rouge">Anaconda3-2023.03-Linux-x86_64</code> is the latest version of Anaconda for Linux available at the time this is being written. Check for the <a href="https://repo.anaconda.com/archive/" rel="external nofollow noopener" target="_blank">versions here</a>. Replace it with the current stable version for download and installation.</p> </li> <li> <p>Once it is copied in the home directory, you can run the following command on the Ubuntu terminal for installation:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>bash Anaconda3-2023.03-Linux-x86_64
</code></pre></div> </div> <p>It will ask you to read the license agreement and your permission for installation. Proceed as needed.</p> </li> <li> <p>Close the Ubuntu terminal and open it back, you will see the base environment for Anaconda is now available. This is how your terminal is going to look like:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(base) $ 
</code></pre></div> </div> </li> <li> <p>Check out these operations and <a href="https://docs.conda.io/projects/conda/en/4.6.0/_downloads/52a95608c49671267e40c689e0bc00ca/conda-cheatsheet.pdf" rel="external nofollow noopener" target="_blank">commands for using Conda</a>.</p> </li> </ol> <h2 id="fenicsxon-linux-and-macos">FEniCSx on Linux and macOS</h2> <ol> <li> <p>Once Anaconda is properly installed, create an environment for <code class="language-plaintext highlighter-rouge">FEniCSx</code>. In addition to the <code class="language-plaintext highlighter-rouge">dolfinx</code> library, I will install <code class="language-plaintext highlighter-rouge">mpich</code>, <code class="language-plaintext highlighter-rouge">pyvista</code>, <code class="language-plaintext highlighter-rouge">cycler</code>, and <code class="language-plaintext highlighter-rouge">matplotlib</code>. <code class="language-plaintext highlighter-rouge">mpich</code> allows parallel processing of different operations within<code class="language-plaintext highlighter-rouge">FEniCSx</code> and the other three packages are used for quick visualization. Standard installation of Anaconda already comes with these three packages but I will still need to install them inside the <code class="language-plaintext highlighter-rouge">FEniCSx</code> environment.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(base)    $ conda create -n fenicsx
(base)    $ conda activate fenicsx
(fenicsx) $ conda install -c conda-forge fenics-dolfinx mpich pyvista matplotlib cycler
</code></pre></div> </div> <p><code class="language-plaintext highlighter-rouge">pyvista</code> supports plotting higher-order unstructured mesh in Jupyter Notebook environments. <code class="language-plaintext highlighter-rouge">matplotlib</code> lacks support for higher-order unstructured mesh. So, it is recommended to use <code class="language-plaintext highlighter-rouge">pyvista</code> for quick visualization. But you can still use <code class="language-plaintext highlighter-rouge">matplotlib</code> for regular plotting.</p> </li> <li> <p>To uninstall <code class="language-plaintext highlighter-rouge">FEniCSx</code> packages from Anaconda, you will have to uninstall everything within the environment. Before you proceed to uninstall check if the <code class="language-plaintext highlighter-rouge">FEniCSx</code> environment is active in the terminal. If it is active, then deactivate it first and proceed to uninstall the packages.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(fenicsx) $ conda deactivate
(base)    $ conda remove -n fenicsx --all
(base)    $ conda clean --all
</code></pre></div> </div> <p>It will ask your permission; proceed as needed. <code class="language-plaintext highlighter-rouge">FEniCSx</code> should be completely uninstalled now.</p> </li> </ol> <h2 id="legacy-fenicson-linux-and-macos-optional">Legacy FEniCS on Linux and macOS (optional)</h2> <p>A lot of the tutorials, examples, and published codes are still written in legacy <code class="language-plaintext highlighter-rouge">FEniCS</code>. So, you may want to install the legacy version in case you want to run codes written in legacy <code class="language-plaintext highlighter-rouge">FEniCS</code>.</p> <ol> <li> <p>The installation process is similar to <code class="language-plaintext highlighter-rouge">FEniCSx</code>. Since higher order mesh wasn’t a feature for legacy <code class="language-plaintext highlighter-rouge">FEniCS</code>, I am skipping the installation of <code class="language-plaintext highlighter-rouge">pyvista</code> here. Necessary visualization can be done using <code class="language-plaintext highlighter-rouge">matplotlib</code>.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(base)   $ conda create -n fenics
(base)   $ conda activate fenics
(fenics) $ conda install -c conda-forge fenics matplotlib cycler
</code></pre></div> </div> </li> <li> <p>Uninstallation procedure for legacy <code class="language-plaintext highlighter-rouge">FEniCS</code> is also similar to the <code class="language-plaintext highlighter-rouge">FEniCSx</code> package.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(fenics) $ conda deactivate
(base)   $ conda remove -n fenics --all
(base)   $ conda clean --all
</code></pre></div> </div> </li> </ol> <h2 id="an-alternative-way-to-install-on-ubuntu-not-recommended">An alternative way to install on Ubuntu (not recommended)</h2> <ol> <li> <p>On Ubuntu, you can also install <code class="language-plaintext highlighter-rouge">FEniCSx</code> using the <code class="language-plaintext highlighter-rouge">apt</code> package manager. Albeit the installation process is simple and lightweight, the <code class="language-plaintext highlighter-rouge">FEniCSx</code> version available via <code class="language-plaintext highlighter-rouge">apt</code> is often not the latest version. So, I do not recommend installing this way.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>sudo add-apt-repository ppa:fenics-packages/fenics
sudo apt update
sudo apt install fenicsx
</code></pre></div> </div> </li> <li> <p>To uninstall <code class="language-plaintext highlighter-rouge">FEniCSx</code> using <code class="language-plaintext highlighter-rouge">apt</code> on Ubuntu, follow the procedures below:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>sudo apt remove fenicsx
sudo apt remove --auto-remove fenicsx
sudo apt purge fenicsx
sudo apt purge --auto-remove fenicsx
</code></pre></div> </div> </li> <li> <p>Legacy <code class="language-plaintext highlighter-rouge">FEniCS</code> can be installed using this approach as well. Please make sure to use <code class="language-plaintext highlighter-rouge">fenics</code> instead of <code class="language-plaintext highlighter-rouge">fenicsx</code> in the command line for installing and uninstalling legacy <code class="language-plaintext highlighter-rouge">FEniCS</code>.</p> </li> </ol> <h3 id="test-your-fenicsxinstallation">Test your FEniCSx installation</h3> <ol> <li> <p>Now we will run a simple <code class="language-plaintext highlighter-rouge">FEniCSx</code> example code to test the installation. If you open the Ubuntu or macOS terminal now, you will see the <code class="language-plaintext highlighter-rouge">(base)</code> environment is active. So, you have to activate the <code class="language-plaintext highlighter-rouge">(fenicsx)</code> environment before running the code.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(base) $ conda activate fenicsx
</code></pre></div> </div> <p>Now you should see:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(fenicsx) $ 
</code></pre></div> </div> <p>In case you close your terminal and reopen it, you will see the <code class="language-plaintext highlighter-rouge">(base)</code> environment is active by default. You will have to activate <code class="language-plaintext highlighter-rouge">(fenicsx)</code> environment using the above command.</p> </li> <li> <p>Create a directory called <code class="language-plaintext highlighter-rouge">fenicsx-code</code> in our WSL home directory and navigate to it:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(fenicsx) $ mkdir fenicsx-code
(fenicsx) $ cd fenicsx-code
</code></pre></div> </div> </li> <li> <p>Copy the following Python code and save it as <code class="language-plaintext highlighter-rouge">poisson.py</code> using VS Code in the above directory. This code solves a simple 2D Poisson problem. Technical details of this code is <a href="https://jsdokken.com/dolfinx-tutorial/chapter1/fundamentals" rel="external nofollow noopener" target="_blank">described here</a>.</p> <div class="language-python highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> <span class="kn">import</span> <span class="n">os</span>
 <span class="kn">import</span> <span class="n">numpy</span>
 <span class="kn">import</span> <span class="n">ufl</span>
 <span class="kn">import</span> <span class="n">dolfinx</span>
 <span class="kn">from</span> <span class="n">dolfinx</span> <span class="kn">import</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">fem</span><span class="p">,</span> <span class="n">io</span><span class="p">,</span> <span class="n">plot</span> 
 <span class="kn">from</span> <span class="n">mpi4py</span> <span class="kn">import</span> <span class="n">MPI</span>
 <span class="kn">from</span> <span class="n">petsc4py</span> <span class="kn">import</span> <span class="n">PETSc</span>
 <span class="kn">import</span> <span class="n">pyvista</span> <span class="k">as</span> <span class="n">pv</span>

 <span class="c1"># clears the terminal and prints dolfinx version
</span> <span class="n">os</span><span class="p">.</span><span class="nf">system</span><span class="p">(</span><span class="sh">'</span><span class="s">clear</span><span class="sh">'</span><span class="p">)</span>
 <span class="c1"># prints dolfinx version
</span> <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">DOLFINx version: </span><span class="si">{</span><span class="n">dolfinx</span><span class="p">.</span><span class="n">__version__</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

 <span class="c1"># no of elements in each direction
</span> <span class="n">NElem</span>   <span class="o">=</span> <span class="mi">8</span>

 <span class="c1"># create a unit square with 8x8 elements with quad elements and use first order shape function
</span> <span class="n">domain</span>  <span class="o">=</span> <span class="n">mesh</span><span class="p">.</span><span class="nf">create_unit_square</span><span class="p">(</span><span class="n">MPI</span><span class="p">.</span><span class="n">COMM_WORLD</span><span class="p">,</span><span class="n">NElem</span><span class="p">,</span><span class="n">NElem</span><span class="p">,</span><span class="n">mesh</span><span class="p">.</span><span class="n">CellType</span><span class="p">.</span><span class="n">quadrilateral</span><span class="p">)</span>
 <span class="n">V</span>       <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nc">FunctionSpace</span><span class="p">(</span><span class="n">domain</span><span class="p">,(</span><span class="sh">"</span><span class="s">CG</span><span class="sh">"</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

 <span class="c1">## define trial and test functions
</span> <span class="n">u</span>       <span class="o">=</span> <span class="n">ufl</span><span class="p">.</span><span class="nc">TrialFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
 <span class="n">v</span>       <span class="o">=</span> <span class="n">ufl</span><span class="p">.</span><span class="nc">TestFunction</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>

 <span class="c1"># source term of the poisson equation
</span> <span class="n">f</span>       <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nc">Constant</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">PETSc</span><span class="p">.</span><span class="nc">ScalarType</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">))</span>

 <span class="c1">## applying boundary conditions
</span> <span class="n">uD</span>      <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nc">Function</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
 <span class="n">uD</span><span class="p">.</span><span class="nf">interpolate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
 <span class="n">tdim</span>    <span class="o">=</span> <span class="n">domain</span><span class="p">.</span><span class="n">topology</span><span class="p">.</span><span class="n">dim</span>
 <span class="n">fdim</span>    <span class="o">=</span> <span class="n">tdim</span> <span class="o">-</span> <span class="mi">1</span>
 <span class="n">domain</span><span class="p">.</span><span class="n">topology</span><span class="p">.</span><span class="nf">create_connectivity</span><span class="p">(</span><span class="n">fdim</span><span class="p">,</span> <span class="n">tdim</span><span class="p">)</span>
 <span class="n">boundary_facets</span> <span class="o">=</span> <span class="n">mesh</span><span class="p">.</span><span class="nf">exterior_facet_indices</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="n">topology</span><span class="p">)</span>
 <span class="n">boundary_dofs</span>   <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nf">locate_dofs_topological</span><span class="p">(</span><span class="n">V</span><span class="p">,</span> <span class="n">fdim</span><span class="p">,</span> <span class="n">boundary_facets</span><span class="p">)</span>
 <span class="n">bc</span>      <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nf">dirichletbc</span><span class="p">(</span><span class="n">uD</span><span class="p">,</span> <span class="n">boundary_dofs</span><span class="p">)</span>

 <span class="c1"># bilinear form
</span> <span class="n">a</span>       <span class="o">=</span> <span class="n">ufl</span><span class="p">.</span><span class="nf">dot</span><span class="p">(</span><span class="n">ufl</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">u</span><span class="p">),</span> <span class="n">ufl</span><span class="p">.</span><span class="nf">grad</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="o">*</span> <span class="n">ufl</span><span class="p">.</span><span class="n">dx</span>
 <span class="n">L</span>       <span class="o">=</span> <span class="n">f</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">ufl</span><span class="p">.</span><span class="n">dx</span>

 <span class="c1"># set PETSc solver options
</span> <span class="n">sol_opts</span> <span class="o">=</span> <span class="p">{</span><span class="sh">"</span><span class="s">ksp_type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">preonly</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">pc_type</span><span class="sh">"</span><span class="p">:</span> <span class="sh">"</span><span class="s">lu</span><span class="sh">"</span><span class="p">}</span>
 <span class="c1"># formulate the problem
</span> <span class="n">problem</span> <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="n">petsc</span><span class="p">.</span><span class="nc">LinearProblem</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">bcs</span><span class="o">=</span><span class="p">[</span><span class="n">bc</span><span class="p">],</span> <span class="n">petsc_options</span><span class="o">=</span><span class="n">sol_opts</span><span class="p">)</span>
 <span class="c1"># solve the problem
</span> <span class="n">uh</span> <span class="o">=</span> <span class="n">problem</span><span class="p">.</span><span class="nf">solve</span><span class="p">()</span>

 <span class="c1">## error calculation
</span> <span class="n">V2</span>          <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nc">FunctionSpace</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="p">(</span><span class="sh">"</span><span class="s">CG</span><span class="sh">"</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
 <span class="n">uex</span>         <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nc">Function</span><span class="p">(</span><span class="n">V2</span><span class="p">)</span>
 <span class="n">uex</span><span class="p">.</span><span class="nf">interpolate</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

 <span class="n">L2_error</span>    <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nf">form</span><span class="p">(</span><span class="n">ufl</span><span class="p">.</span><span class="nf">inner</span><span class="p">(</span><span class="n">uh</span> <span class="o">-</span> <span class="n">uex</span><span class="p">,</span> <span class="n">uh</span> <span class="o">-</span> <span class="n">uex</span><span class="p">)</span> <span class="o">*</span> <span class="n">ufl</span><span class="p">.</span><span class="n">dx</span><span class="p">)</span>
 <span class="n">error_local</span> <span class="o">=</span> <span class="n">fem</span><span class="p">.</span><span class="nf">assemble_scalar</span><span class="p">(</span><span class="n">L2_error</span><span class="p">)</span>
 <span class="n">error_L2</span>    <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="nf">allreduce</span><span class="p">(</span><span class="n">error_local</span><span class="p">,</span> <span class="n">op</span><span class="o">=</span><span class="n">MPI</span><span class="p">.</span><span class="n">SUM</span><span class="p">))</span>

 <span class="n">error_max</span>   <span class="o">=</span> <span class="n">numpy</span><span class="p">.</span><span class="nf">max</span><span class="p">(</span><span class="n">numpy</span><span class="p">.</span><span class="nf">abs</span><span class="p">(</span><span class="n">uD</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">array</span><span class="o">-</span><span class="n">uh</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">array</span><span class="p">))</span>

 <span class="c1"># print the error
</span> <span class="k">if</span> <span class="n">domain</span><span class="p">.</span><span class="n">comm</span><span class="p">.</span><span class="n">rank</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
     <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error_L2 : </span><span class="si">{</span><span class="n">error_L2</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>
     <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">"</span><span class="s">Error_max : </span><span class="si">{</span><span class="n">error_max</span><span class="si">:</span><span class="p">.</span><span class="mi">2</span><span class="n">e</span><span class="si">}</span><span class="sh">"</span><span class="p">)</span>

 <span class="c1"># writing output files in xdmf format
</span> <span class="k">with</span> <span class="n">io</span><span class="p">.</span><span class="nc">XDMFFile</span><span class="p">(</span><span class="n">domain</span><span class="p">.</span><span class="n">comm</span><span class="p">,</span> <span class="sh">"</span><span class="s">output.xdmf</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">w</span><span class="sh">"</span><span class="p">)</span> <span class="k">as</span> <span class="n">xdmf</span><span class="p">:</span>
     <span class="n">xdmf</span><span class="p">.</span><span class="nf">write_mesh</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
     <span class="n">xdmf</span><span class="p">.</span><span class="nf">write_function</span><span class="p">(</span><span class="n">uh</span><span class="p">)</span>

 <span class="c1"># 2D contour plots of the mesh and result using pyvista
</span> <span class="c1">#pv.start_xvfb()    # Uncomment the line on WSL
</span> <span class="n">pv</span><span class="p">.</span><span class="n">off_screen</span> <span class="o">=</span> <span class="bp">True</span>
 <span class="n">topology</span><span class="p">,</span> <span class="n">cell_types</span><span class="p">,</span> <span class="n">geometry</span> <span class="o">=</span> <span class="n">plot</span><span class="p">.</span><span class="nf">create_vtk_mesh</span><span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">tdim</span><span class="p">)</span>
 <span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nc">UnstructuredGrid</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">cell_types</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span>

 <span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nc">Plotter</span><span class="p">()</span>
 <span class="n">plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span><span class="n">show_edges</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
 <span class="n">plotter</span><span class="p">.</span><span class="nf">view_xy</span><span class="p">()</span>
 <span class="n">plotter</span><span class="p">.</span><span class="nf">save_graphic</span><span class="p">(</span><span class="sh">'</span><span class="s">mesh.pdf</span><span class="sh">'</span><span class="p">)</span>

 <span class="n">u_topology</span><span class="p">,</span> <span class="n">u_cell_types</span><span class="p">,</span> <span class="n">u_geometry</span> <span class="o">=</span> <span class="n">plot</span><span class="p">.</span><span class="nf">create_vtk_mesh</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
 <span class="n">u_grid</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nc">UnstructuredGrid</span><span class="p">(</span><span class="n">u_topology</span><span class="p">,</span> <span class="n">u_cell_types</span><span class="p">,</span> <span class="n">u_geometry</span><span class="p">)</span>
 <span class="n">u_grid</span><span class="p">.</span><span class="n">point_data</span><span class="p">[</span><span class="sh">"</span><span class="s">u</span><span class="sh">"</span><span class="p">]</span> <span class="o">=</span> <span class="n">uh</span><span class="p">.</span><span class="n">x</span><span class="p">.</span><span class="n">array</span><span class="p">.</span><span class="n">real</span>
 <span class="n">u_grid</span><span class="p">.</span><span class="nf">set_active_scalars</span><span class="p">(</span><span class="sh">"</span><span class="s">u</span><span class="sh">"</span><span class="p">)</span>
 <span class="n">u_plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="p">.</span><span class="nc">Plotter</span><span class="p">()</span>
 <span class="n">u_plotter</span><span class="p">.</span><span class="nf">add_mesh</span><span class="p">(</span><span class="n">u_grid</span><span class="p">,</span><span class="n">show_edges</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
 <span class="n">u_plotter</span><span class="p">.</span><span class="nf">view_xy</span><span class="p">()</span>
 <span class="n">u_plotter</span><span class="p">.</span><span class="nf">save_graphic</span><span class="p">(</span><span class="sh">'</span><span class="s">contour.pdf</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div> </div> </li> <li> <p>Now run the Python code from the Ubuntu terminal:</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>(fenicsx) $ python3 poisson.py
</code></pre></div> </div> </li> <li> <p>This should save the <code class="language-plaintext highlighter-rouge">.h5</code> and <code class="language-plaintext highlighter-rouge">.xdmf</code> files with the results and save the mesh and contour plot of the primary variable <code class="language-plaintext highlighter-rouge">.pdf</code> files in the working directory.</p> </li> </ol> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/link-intel-and-vs-abaqus-2020/">Linking Intel oneAPI and Visual Studio with Abaqus</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/latex-powerpoint-vscode-mac/">LaTeX in MS PowerPoint and VS Code on macOS</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2024/licensing-and-citing-GitHub/">Licensing and citing contents from online repositories</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/relearning-mathematics/">Relearning mathematics</a> </li> </div> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Copyright © 2024 Bibekananda Datta. All rights reserved. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script defer src="/assets/js/bootstrap-toc.min.js?c82ff4de8b0955d6ff14f5b05eed7eb6"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>