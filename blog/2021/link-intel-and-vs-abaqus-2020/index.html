<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> Linking Intel oneAPI and Visual Studio with Abaqus | Bibekananda Datta </title> <meta name="author" content="Bibekananda Datta"> <meta name="description" content="A tutorial to link Fortran with Abaqus"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%E2%9A%9B%EF%B8%8F&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://bibekanandadatta.github.io/blog/2021/link-intel-and-vs-abaqus-2020/"> <script src="/assets/js/theme.js?a5ca4084d3b81624bcfa01156dae2b8e"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>initTheme();</script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">Bibekananda</span> Datta </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">About </a> </li> <li class="nav-item "> <a class="nav-link" href="/research/">Research </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">Publications </a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">Repositories </a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">Teaching </a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">CV </a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">Blog </a> </li> <li class="nav-item "> <a class="nav-link" href="/surfboard/">Surfboard </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">Linking Intel oneAPI and Visual Studio with Abaqus</h1> <p class="post-meta"> February 13, 2021 </p> <p class="post-tags"> <a href="/blog/2021"> <i class="fa-solid fa-calendar fa-sm"></i> 2021 </a>   ·   <a href="/blog/tag/abaqus"> <i class="fa-solid fa-hashtag fa-sm"></i> Abaqus</a>   <a href="/blog/tag/fortran"> <i class="fa-solid fa-hashtag fa-sm"></i> Fortran</a>   <a href="/blog/tag/programming"> <i class="fa-solid fa-hashtag fa-sm"></i> programming</a>   <a href="/blog/tag/finite-element"> <i class="fa-solid fa-hashtag fa-sm"></i> finite-element</a>   <a href="/blog/tag/visual-studio"> <i class="fa-solid fa-hashtag fa-sm"></i> Visual-Studio</a>   <a href="/blog/tag/intel-oneapi"> <i class="fa-solid fa-hashtag fa-sm"></i> Intel-oneAPI</a>   <a href="/blog/tag/user-subroutine"> <i class="fa-solid fa-hashtag fa-sm"></i> user-subroutine</a>     ·   <a href="/blog/category/tutorial"> <i class="fa-solid fa-tag fa-sm"></i> tutorial</a>   </p> </header> <article class="post-content"> <div id="markdown-content"> <p>ABAQUS is one of the most popular commercial finite element programs in both academia and industry. In addition to the built-in physics and material models, ABAQUS allows its users to program new features through the user subroutine feature, typically written in Fortran or C++. The recommended compiler for ABAQUS user subroutines is Intel Fortran which is a part of the Intel oneAPI package since 2021. Additionally, on Windows OS, it requires installing Microsoft Visual Studio for linking and compilation. It always has been quite confusing to the users how to configure ABAQUS to use this feature. In this blog post, I will describe the procedures for installing necessary package and configuring ABAQUS to avail the user subroutine feature.</p> <h2 id="installation">Installation</h2> <h3 id="softwares-you-will-need">Softwares you will need</h3> <ol> <li>ABAQUS finite element solver</li> <li>Microsoft Visual Studio Community Edition</li> <li>Intel oneAPI Base Toolkit and Intel oneAPI HPC Toolkit</li> <li>Notepad or Notepad++ (or some text editor)</li> </ol> <p>For my first time, I used ABAQUS 2020, Microsoft Visual Studio 2019, Intel oneAPI 2021 followed by different versions of these packages in past few years. But I will use examples and images from the first installation I did back in February 2021. If you are doing it right now, you may have different versions of these packages, however the procedure is almost identical. A few things to note before you begin installation:</p> <ol> <li>Please ensure you have the compatible version of Visual Studio and Intel oneAPI.</li> <li>Install Visual Studio and Intel oneAPI in that order. ABAQUS can be installed at any point during the process (before or after).</li> <li>You will need to save the batch files related to these software using administrator access. So launch Notepad from Windows program menu as administrator or use Notepad++. I used Notepad++.</li> </ol> <h3 id="abaqus-installation">ABAQUS Installation</h3> <p>ABAQUS user-defined features are only available through its academic (research) or commercial license which you should obtain from your university or workplace. ABAQUS Installation process is trivial depending on how you obtain the executables. While you going through the installation process, make sure to install ABAQUS with CAA API components. ABAQUS should be installed in <code class="language-plaintext highlighter-rouge">C:\SIMULIA</code> directory.</p> <h3 id="microsoft-visual-studio">Microsoft Visual Studio</h3> <p>Intel oneAPI 2021 supports Visual Studio 2017 and Visual Studio 2019. Please search on Google to download Visual Studio Community Edition. I used the latest one, VS 2019, at that time. <strong>If you are downloading a newer version, please make sure it is compatible with Intel oneAPI.</strong></p> <p>Download the installer and click on it to start the installation process. On the installation page, please select <code class="language-plaintext highlighter-rouge">Desktop development with C++</code> and keep the rest of the default. It will take a few minutes to install.</p> <h3 id="intel-oneapi">Intel oneAPI</h3> <p>Intel oneAPI is split into two packages; Intel oneAPI Base Toolkit and Intel oneAPI HPC Toolkit. To be able to use Intel Fortran and C++ compilers, you will need both toolkits (specially for MKL libraries and parallel processing).</p> <ol> <li> <p>Once both of the packages are downloaded, first install the Intel oneAPI Base Toolkit (I chose default installation). It will recognize the existence of Visual Studio. Please click on the appropriate version and move forward with installation. It might take about 15-20 minutes to install the Base Toolkit. The next step is to install the HPC tool kit in the same procedure. This will take 5-10 minutes to get installed.</p> </li> <li> <p>If you have done default installation of Intel oneAPI, its components should be located in <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\Intel\oneAPI</code>. Navigate to this directory and then navigate further to ensure <code class="language-plaintext highlighter-rouge">ifort</code> executable is available in the following (or similar) directory. Copy the directory in a text file for later use.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\windows\bin\intel64
</code></pre></div> </div> </li> </ol> <h2 id="linking-intel-fortran-with-abaqus">Linking Intel Fortran with Abaqus</h2> <p>While the installation of the software packages are cakewalk, it gets complicated at this stage. Follow one of the two methods below. I prefer <strong>Method 1</strong> because its easier and I was able to configure Intel oneMKL library as well in this approach.</p> <h3 id="method-1-editing-abaqus-batch-file">Method 1: Editing ABAQUS batch file</h3> <ol> <li> <p>Navigate to <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\env</code> (or similar directory) and ensure <code class="language-plaintext highlighter-rouge">vars.bat</code> file is available. If the directory name is different in your installation, search for <code class="language-plaintext highlighter-rouge">vars.bat</code> file through Windows Explorer and navigate to the directory. Copy the file directory to a text file.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\env\vars.bat
</code></pre></div> </div> </li> <li> <p>Navigate to <code class="language-plaintext highlighter-rouge">C:\SIMULIA\Commands</code> directory and open the <code class="language-plaintext highlighter-rouge">abq2020.bat</code> (or the version you installed) file with any text editor. In the beginning of the file, add the following lines to the file and <strong>save it as administrator</strong>.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> SET PATH=%PATH%; C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\windows\bin\intel64; call "C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\env\vars.bat" intel64
</code></pre></div> </div> </li> </ol> <p>As you can see, the <code class="language-plaintext highlighter-rouge">PATH</code> in the first line is the <code class="language-plaintext highlighter-rouge">PATH</code> for ifort compiler executables which was copied during installation. The second line is calling the batch file for ifort compiler which sets the environment variales when ABAQUS is invoked.</p> <h3 id="method-2-gui-approach">Method 2: GUI Approach</h3> <ol> <li> <p>Navigate to C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\env (or similar directory) and ensure vars.bat file is available. If the directory name is different in your installation, search for <code class="language-plaintext highlighter-rouge">vars.bat</code> file through Windows Explorer and navigate to the directory. Copy the file directory to a text file.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\env\vars.bat
</code></pre></div> </div> </li> <li> <p>Copy the path locations with file names for both of them. From the Windows start menu, search <strong>Edit the system environment variables</strong>. Then click on <strong>Environment Variables &gt; Path</strong> (under system variables) and New. Paste those previously copied batch file paths and save them. You can see I already added those (2nd and 3rd from the bottom on the rightmost image).</p> <p><a href="/assets/img/abq_sys_path.png"><img src="/assets/img/abq_sys_path.png" width="800"></a></p> </li> <li> <p>The next step is to link the Intel Fortran compiler with Abaqus shown step-by-step in the following image. Search Abaqus Command from the Windows Menu. Click on Open File Location. Then in Windows Explorer right click on Abaqus Command and click on Properties. In the shortcut tab, locate the target. Change from <code class="language-plaintext highlighter-rouge">C:\WINDOWS\system32\cmd.exe /k</code> to the following</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> "C:\Program Files (x86)\Intel\oneAPI\compiler\2021.1.1\env\vars.bat" intel64 vs2019 &amp; C:\WINDOWS\system32\cmd.exe /k
</code></pre></div> </div> <p><a href="/assets/img/abq_link.png"><img src="/assets/img/abq_link.png" width="800"></a></p> </li> </ol> <h2 id="verify-linking-and-installation">Verify Linking and Installation</h2> <p>Open Abaqus Command (you can also do it from cmd or Powershell terminal) from the Windows menu and type <code class="language-plaintext highlighter-rouge">abaqus info=system</code>. It should show system information as follows, including the new compiler and linker information.</p> <p><a href="/assets/img/abq_sys.png"><img src="/assets/img/abq_sys.png" width="850"></a></p> <p>To verify further, type <code class="language-plaintext highlighter-rouge">abaqus verify -user_std</code> and/ or <code class="language-plaintext highlighter-rouge">abaqus verify -user_exp</code> on the Abaqus Command window. If the installation and linking were successful, then you will see something like this:</p> <p><a href="/assets/img/abq_user_std.png"><img src="/assets/img/abq_user_std.png" width="850"></a></p> <p><code class="language-plaintext highlighter-rouge">abaqus verify -user_std</code> is for verifying user subroutine feature for Abaqus/ Standard (UMAT, UEL, etc.) and <code class="language-plaintext highlighter-rouge">abaqus verify -user_exp</code> is for verifying user subroutine feature for Abaqus/ Explicit (VUMAT, VUEL, etc.). To verify all of the features of Abaqus you can type <code class="language-plaintext highlighter-rouge">abaqus verify -all</code>. Please note, this might take a while and some components might not pass depending on your license and installation.</p> <h3 id="bug-fix-for-abaqus-20192020">Bug fix for Abaqus 2019/2020</h3> <p>If you still have issues compiling user subroutines, one of the possible bug could be fixed by following approach. I experienced this issue when I first installed these packages; it may have been fixed by now. But at that time. SIMULIA suggested making new Intel oneAPI Toolkits compatible with Abaqus. Please navigate to <code class="language-plaintext highlighter-rouge">C:\Program Files\Dassault Systemes\SimulationServices\V6R2020x\win_b64\SMA\site</code> directory and locate <code class="language-plaintext highlighter-rouge">abaqus_v6.env</code> file. Open the file using a text editor, add the following line at the end of the file, and <strong>save the file as administrator</strong>.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>compile_fortran += ['/names:lowercase',]
</code></pre></div></div> <h2 id="linking-intel-onemkl-library-with-abaqus">Linking Intel oneMKL Library with ABAQUS</h2> <p>This is an advanced and optional feature which is very rarely used. Intel oneMKL library includes efficient math subroutines (e.g., BLAS and LAPACK) which can be included in user subroutine to perform computation. However, from time to time, I found it useful to take advantages of existing libraries to write efficient subroutines.</p> <ol> <li> <p>Navigate to <code class="language-plaintext highlighter-rouge">C:\Program Files (x86)\Intel\oneAPI\mkl\2021.1.1\env</code>, ensure the <code class="language-plaintext highlighter-rouge">vars.bat</code> file is available for oneMKL package. This batch file is for Intel oneMKL library. Copy the file directory as usual.</p> </li> <li> <p>Navigate to <code class="language-plaintext highlighter-rouge">C:\SIMULIA\Commands</code> and open the abq2020.bat (or corresponding version) file. Add the following line below the two lines previously added for ifort compiler. Save the file as administrator using the same approach as above; either run Notepad as administrator from Windows program menu or use Notepad++.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> call "C:\Program Files (x86)\Intel\oneAPI\mkl\2021.1.1\env\vars.bat" intel64
</code></pre></div> </div> </li> <li> <p>In the previous step, providing Intel oneMKL batch file location in the ABAQUS batch file will source the environment variables when ABAQUS is called to run simulations. However, to compile code with Intel oneMKL library, you will need to do one more step. Locate to <code class="language-plaintext highlighter-rouge">C:\SIMULIA\EstProducts\2020\win_b64\SMA\site</code> directory and open <strong>win86_64.env</strong> file. Find the following line in the file and add the <code class="language-plaintext highlighter-rouge">/Qmkl:sequential</code> compiler option as shown below. Rest of the file should be same. Save the file as administrator.</p> <div class="language-plaintext highlighter-rouge"> <div class="highlight"><pre class="highlight"><code> compile_fortran=['ifort','/Qmkl:sequential', ... ...]
</code></pre></div> </div> <p>You may be able to run oneMKL library in parallel with ABAQUS user surboutines by adding <code class="language-plaintext highlighter-rouge">/Qmkl:parallel</code> compiler flag. However, I never tested this feature.</p> </li> </ol> </div> </article> <h2>References</h2> <div class="publications"> </div> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/latex-powerpoint-vscode-mac/">LaTeX in MS PowerPoint and VS Code on macOS</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2023/getting-started-with-fenicsx/">Getting started with FEniCSx</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2021/relearning-mathematics/">Relearning mathematics</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> Copyright © 2024 Bibekananda Datta. All rights reserved. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?b7816bd189846d29eded8745f9c4cf77"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script> <script type="text/javascript">function progressBarSetup(){"max"in document.createElement("progress")?(initializeProgressElement(),$(document).on("scroll",function(){progressBar.attr({value:getCurrentScrollPosition()})}),$(window).on("resize",initializeProgressElement)):(resizeProgressBar(),$(document).on("scroll",resizeProgressBar),$(window).on("resize",resizeProgressBar))}function getCurrentScrollPosition(){return $(window).scrollTop()}function initializeProgressElement(){let e=$("#navbar").outerHeight(!0);$("body").css({"padding-top":e}),$("progress-container").css({"padding-top":e}),progressBar.css({top:e}),progressBar.attr({max:getDistanceToScroll(),value:getCurrentScrollPosition()})}function getDistanceToScroll(){return $(document).height()-$(window).height()}function resizeProgressBar(){progressBar.css({width:getWidthPercentage()+"%"})}function getWidthPercentage(){return getCurrentScrollPosition()/getDistanceToScroll()*100}const progressBar=$("#progress");window.onload=function(){setTimeout(progressBarSetup,50)};</script> </body> </html>